---
title: "ã€Flutterã€‘Pigeon ã‚’ä½¿ã£ã¦ Plugin Package ã‚’ä½œæˆã™ã‚‹"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["firebase", "dart", "pigeon", "plugin", "package"]
published: true
publication_name: "altiveinc"
---

## ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ï¼Altiveæ ªå¼ä¼šç¤¾ã®Flutterã‚¢ãƒ—ãƒªé–‹ç™ºè€…ã®å°æ—é¼å¤ªï¼ˆ[@naipaka](https://twitter.com/naipakapaka)ï¼‰ã§ã™ğŸ¦™

ä»Šæœˆåˆã‚ã«ã€å¼Šç¤¾ã§é–‹ç™ºã—ãŸã€Œã‚ã§ãŸï¼ã€ã¨ã„ã†å®¶åº­èœåœ’ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚

https://apps.apple.com/app/id6479965558

https://play.google.com/store/apps/details?id=jp.co.altive.medeta

ã“ã®ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½ã®ä¸€ã¤ã« [è¤‡æ•°æšã®ç”»åƒã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã‚’ä½œæˆã™ã‚‹](https://x.com/medetaapp/status/1777557089340317799) ã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚‹ã®ã§ã™ãŒã€å‡¦ç†è‡ªä½“ã¯å„ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã§è¡Œãªã£ã¦ãŠã‚Šã€ã“ã®æ©Ÿèƒ½ã‚’ä»–ã®ã‚¢ãƒ—ãƒªã§ã‚‚æµç”¨ã§ãã‚‹ã‚ˆã†ã« Plugin Package ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚ï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å…¬é–‹ã¯ã—ã¦ã„ã¾ã›ã‚“ï¼‰

ã“ã®ã¨ãåˆã‚ã¦ [Pigeon](https://pub.dev/packages/pigeon) ã‚’ä½¿ã£ãŸ Plugin Package ã‚’ä½œæˆã—ãŸã®ã§ã€ãã®æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

## Pigeon ã¨ã¯

Flutter ã¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–“ã®é€šä¿¡ã‚’è¡Œã†ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã€[MethodChannel](https://docs.flutter.dev/platform-integration/platform-channels) ãŒã‚ã‚Šã¾ã™ãŒã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®ã‚„ã‚Šå–ã‚ŠãŒæ–‡å­—åˆ—ã§è¡Œã‚ã‚Œã‚‹ãŸã‚ã€å‹å®‰å…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

[Pigeon](https://pub.dev/packages/pigeon) ã¯ã€Flutter ã¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–“ã®é€šä¿¡ã‚’å‹å®‰å…¨ã§è¡Œã†ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

Dart å´ã§ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã€å‹å®‰å…¨ãªé€šä¿¡ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://pub.dev/packages/pigeon

## Pigeon ã‚’ä½¿ã£ãŸ Plugin Package ã®ä½œæˆ

ãã‚Œã§ã¯ã€ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã‚’ä½œæˆã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é¡Œæã«ã€Pigeon ã‚’ä½¿ã£ãŸ Plugin Package ã®ä½œæˆæ‰‹é †ã‚’èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚
â€»å®Ÿéš›ã«ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã‚’ä½œæˆã™ã‚‹å®Ÿè£…ã¯çœç•¥ã—ã¦ã„ã¾ã™ã€‚

### 1. Plugin Package ã®ä½œæˆ & Pigeon è¿½åŠ 

ã¾ãšã¯ã€Plugin Package ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚
ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã® Plugin Package ã¨ã—ã¦ã€`timelapse_creator` ã¨ã„ã†åå‰ã§ä½œæˆã—ã¾ã™ã€‚

```bash
flutter create --org jp.co.altive --template=plugin --platforms=android,ios timelapse_creator --project-name timelapse_creator
```

è‡ªå‹•ã§ä½œæˆã•ã‚ŒãŸä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ MethodChannel ã‚’ä½¿ã£ãŸé€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
Pigeon ã‚’ä½¿ã£ãŸå®Ÿè£…ã§ã¯ä¸è¦ãªãŸã‚ã€å‰Šé™¤ã—ã¦ãŠãã¾ã™ã€‚

- `lib/timelapse_creator_method_channel.dart`
- `lib/timelapse_creator_platform_interface.dart`

ä»¥ä¸‹ã¯ã€å¾Œã»ã© Barrel file ã¨ã—ã¦ä½¿ã†ã®ã§ã€ä¸­èº«ã‚’ç©ºã«ã—ã¦ãŠãã¾ã™ã€‚

- `lib/timelapse_creator.dart`

æ¬¡ã«ã€Pigeon ã‚’ä¾å­˜é–¢ä¿‚ã«è¿½åŠ ã—ã¾ã™ã€‚

```yaml:pubspec.yaml
dev_dependencies:
  flutter_test:
    sdk: flutter
  pigeon: ^18.0.0
```

ã“ã‚Œã§ã€Pigeon ã‚’ä½¿ã£ãŸ Plugin Package ã®ä½œæˆæº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚

### 2. Pigeon ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©

Pigeon ã‚’ä½¿ã£ã¦ Flutter ã‹ã‚‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å‡¦ç†ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `pigeons` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€`messages.dart` ã‚’ä½œæˆã—ã¾ã™ã€‚

:::message
ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã€ãƒ•ã‚¡ã‚¤ãƒ«åã¯ä»»æ„ã®ã‚ˆã†ã§ã™ãŒã€Pigeon ã®æ…£ç¿’ã¨ã—ã¦ `pigeons` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `messages.dart` ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¤šã„ã‚ˆã†ã§ã™ã€‚

å‚è€ƒï¼š
- [pigeon_plugin_example](https://github.com/gaaclarke/pigeon_plugin_example/blob/master/pigeons/messages.dart)
- [video_player](https://github.com/flutter/packages/blob/main/packages/video_player/video_player_avfoundation/pigeons/messages.dart)
:::

`messages.dart` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚

```dart:message.dart
import 'package:pigeon/pigeon.dart';

// 1. PigeonOptionsã‚’ä½¿ã£ã¦ã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å‡ºåŠ›å…ˆã‚’æŒ‡å®šã€‚
@ConfigurePigeon(
  PigeonOptions(
    dartOut: 'lib/src/messages.dart',
    dartOptions: DartOptions(),
    kotlinOut:
        'android/src/main/kotlin/jp/co/altive/timelapse_creator/Messages.kt',
    kotlinOptions: KotlinOptions(),
    swiftOut: 'ios/Classes/Messages.swift',
    swiftOptions: SwiftOptions(),
  ),
)
// 2. Input ã¨ Output ã®ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã€‚
class SourceMessage {
  SourceMessage(this.imageBytesList, this.frameRate);

  List<Uint8List?> imageBytesList;
  int frameRate;
}

class TimelapseMessage {
  TimelapseMessage(this.videoBytes);

  Uint8List videoBytes;
}

// 3. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã€‚
@HostApi()
// ignore: one_member_abstracts
abstract class TimelapseCreatorApi {
  @async
  TimelapseMessage create(SourceMessage msg);
}
```

#### â…°. PigeonOptionsã‚’ä½¿ã£ã¦ã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å‡ºåŠ›å…ˆã‚’æŒ‡å®š

`@ConfigurePigeon` ã®å¼•æ•°ã« `PigeonOptions` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å‡ºåŠ›å…ˆã‚’æŒ‡å®šã§ãã¾ã™ã€‚
ä»Šå›ã¯ã€ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã®å‡¦ç†ã‚’ Swift ã¨ Kotlin ã§è¡Œã†ãŸã‚ã€ãã‚Œãã‚Œã®å‡ºåŠ›å…ˆã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

#### â…±. Input ã¨ Output ã®ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©

`SourceMessage` ã¨ `TimelapseMessage` ã¯ã€ãã‚Œãã‚Œå…¥åŠ›ã¨å‡ºåŠ›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ã€è¤‡æ•°ã®ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
https://docs.flutter.dev/platform-integration/platform-channels#codec

#### â…². ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©

`@HostApi` ã‚’ä»˜ä¸ã—ãŸ `TimelapseCreatorApi` ã¯ã€Dart å´ã§å‘¼ã³å‡ºã™ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

ä»Šå›ã®ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹ç”Ÿæˆã®ã‚ˆã†ã«éåŒæœŸã§å‡¦ç†ã‚’è¡Œã†å ´åˆã¯ã€`@async` ã‚’ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©ã§ããŸã‚‰ã€Pigeon ã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
flutter pub run pigeon --input pigeons/messages.dart
```

ã“ã‚Œã§ã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

- `lib/src/messages.dart`
- `android/src/main/kotlin/jp/co/altive/timelapse_creator/Messages.kt`
- `ios/Classes/Messages.swift`

### 3. å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…

æœ€å¾Œã«ã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

#### iOS

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆæ™‚ã«ç”Ÿæˆã•ã‚ŒãŸ `ios/Classes/TimelapseCreatorPlugin.swift` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```diff swift:TimelapseCreatorPlugin.swift
import Flutter
import UIKit

- public class TimelapseCreatorPlugin: NSObject, FlutterPlugin {
+ public class TimelapseCreatorPlugin: NSObject, FlutterPlugin, TimelapseCreatorApi {
  public static func register(with registrar: FlutterPluginRegistrar) {
-     let channel = FlutterMethodChannel(name: "timelapse_creator", binaryMessenger: registrar.messenger())
-     let instance = TimelapseCreatorPlugin()
-     registrar.addMethodCallDelegate(instance, channel: channel)
+     // 1. è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ TimelapseCreatorApiSetup ã‚’ä½¿ã£ã¦ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç™»éŒ²ã€‚
+     let binaryMessenger = registrar.messenger()
+     let instance = TimelapseCreatorPlugin()
+     TimelapseCreatorApiSetup.setUp(binaryMessenger: binaryMessenger, api: instance)
  }

-   public func handle(_ call: FlutterMethodCall, result: @escaping FlutterResult) {
-     switch call.method {
-     case "getPlatformVersion":
-       result("iOS " + UIDevice.current.systemVersion)
-     default:
-       result(FlutterMethodNotImplemented)
-     }
-   }
+   func create(msg: SourceMessage, completion: @escaping (Result<TimelapseMessage, Error>) -> Void) {
+         // 2. ã“ã“ã§ç”»åƒã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã¸å¤‰æ›ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã€‚
+   }
}
```

##### â…°. è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ TimelapseCreatorApiSetup ã‚’ä½¿ã£ã¦ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç™»éŒ²

`TimelapseCreatorPlugin` ã§ `TimelapseCreatorApi` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã€`TimelapseCreatorApiSetup.setUp` ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€Dart å´ã‹ã‚‰ `TimelapseCreatorApi` ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

##### â…±. ã“ã“ã§ç”»åƒã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã¸å¤‰æ›ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…

`create` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€`TimelapseCreatorApi` ã§è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚

ã“ã“ã§ã€ç”»åƒã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã¸å¤‰æ›ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

:::message
Xcode ã§ä¿®æ­£ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§è¡Œã£ã¦ã„ã¾ã—ãŸã€‚
ä»–ã«ã„ã„ã‚„ã‚Šæ–¹ã‚ã‚Œã°æ•™ãˆã¦ã„ãŸã ããŸã„ã§ã™ğŸ™
1. `example/ios` ã§ pod install
2. `example/ios/Runner.xcworkspace` ã‚’é–‹ã
3. `Pods/Development Pods/timelapse_creator`ã®ä¸­ã‚’è¾¿ã‚Šã€`Classes/TimelapseCreatorPlugin.swift` ã‚’é–‹ã
![Xcode](/images/pigeon-edit-in-xcode.png)
*â€»`Pods/Development Pods/timelapse_creator` ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚*
:::

#### Android

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆæ™‚ã«ç”Ÿæˆã•ã‚ŒãŸ `android/src/main/kotlin/jp/co/altive/timelapse_creator/TimelapseCreatorPlugin.kt` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```diff kotlin:TimelapseCreatorPlugin.kt
package jp.co.altive.timelapse_creator

- import androidx.annotation.NonNull

+ import SourceMessage
+ import TimelapseCreatorApi
+ import TimelapseMessage
import io.flutter.embedding.engine.plugins.FlutterPlugin
- import io.flutter.plugin.common.MethodCall
- import io.flutter.plugin.common.MethodChannel
- import io.flutter.plugin.common.MethodChannel.MethodCallHandler
- import io.flutter.plugin.common.MethodChannel.Result

/** TimelapseCreatorPlugin */
- class TimelapseCreatorPlugin: FlutterPlugin, MethodCallHandler {
-   /// The MethodChannel that will the communication between Flutter and native Android
-   ///
-   /// This local reference serves to register the plugin with the Flutter Engine and unregister it
-   /// when the Flutter Engine is detached from the Activity
-   private lateinit var channel : MethodChannel
+ class TimelapseCreatorPlugin : FlutterPlugin, TimelapseCreatorApi {

  override fun onAttachedToEngine(flutterPluginBinding: FlutterPlugin.FlutterPluginBinding) {
-     channel = MethodChannel(flutterPluginBinding.binaryMessenger, "timelapse_creator")
-     channel.setMethodCallHandler(this)
+     // 1. è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ TimelapseCreatorApi.setUp ã‚’ä½¿ã£ã¦ã€ãƒã‚¤ãƒŠãƒªãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼ã¨è‡ªèº«ã‚’ç™»éŒ²
+     TimelapseCreatorApi.setUp(flutterPluginBinding.binaryMessenger, this)
  }

+  override fun create(msg: SourceMessage, callback: (Result<TimelapseMessage>) -> Unit) {
+    // 2. ã“ã“ã§ç”»åƒã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã¸å¤‰æ›ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã€‚
+  }

-   override fun onMethodCall(call: MethodCall, result: Result) {
-     if (call.method == "getPlatformVersion") {
-       result.success("Android ${android.os.Build.VERSION.RELEASE}")
-     } else {
-       result.notImplemented()
-     }
-   }

  override fun onDetachedFromEngine(binding: FlutterPlugin.FlutterPluginBinding) {
-     channel.setMethodCallHandler(null)
  }
}
```

##### â…°. è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ TimelapseCreatorApi.setUp ã‚’ä½¿ã£ã¦ã€ãƒã‚¤ãƒŠãƒªãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼ã¨è‡ªèº«ã‚’ç™»éŒ²

`TimelapseCreatorPlugin` ã§ `TimelapseCreatorApi` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã€`TimelapseCreatorApi.setUp` ã‚’ä½¿ã£ã¦ãƒã‚¤ãƒŠãƒªãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼ã¨è‡ªèº«ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€Dart å´ã‹ã‚‰ `TimelapseCreatorApi` ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

##### â…±. ã“ã“ã§ç”»åƒã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã¸å¤‰æ›ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…

SwiftåŒæ§˜ã€`create`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€`TimelapseCreatorApi` ã§è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚

ã“ã“ã§ã€ç”»åƒã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ãƒ—ã‚¹å‹•ç”»ã¸å¤‰æ›ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

:::message
ã“ã¡ã‚‰ã¯ã€Android Studio ã§ä¿®æ­£ã™ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚
`timelapse_creator/android` ã‚’ Android Studio ã§é–‹ã„ã¦ã€`TimelapseCreatorPlugin.kt` ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚
![Android Studio](/images/pigeon-edit-in-android-studio.png)
:::

### 4. Dart å´ã§ API ã‚’å‘¼ã³å‡ºã™

æœ€å¾Œã«ã€Dart å´ã§ API ã‚’å‘¼ã³å‡ºã™å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

`lib/src` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `timelapse_creator.dart` ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

```dart:lib/src/timelapse_creator.dart
import 'package:flutter/foundation.dart';

import 'messages.dart';

class TimelapseCreator {
  final _api = TimelapseCreatorApi();

  Future<Uint8List> create({
    required List<Uint8List> imageBytesList,
    required int frameRate,
  }) async {
    final response = await _api.create(
      SourceMessage(imageBytesList: imageBytesList, frameRate: frameRate),
    );
    return response.videoBytes;
  }
}
```

ãã—ã¦ã€Barrel file ã¨ã—ã¦ã€`lib/timelapse_creator.dart` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½è¨˜ã—ã¾ã™ã€‚

```dart:lib/timelapse_creator.dart
export 'src/timelapse_creator.dart';
```

ã“ã‚Œã§ã€ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä¾å­˜é–¢ä¿‚ã«è¿½åŠ ã™ã‚Œã°ã€Flutter å´ã‹ã‚‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å‡¦ç†ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼

```dart:example
final timelapseCreator = TimelapseCreator();
final videoBytes = await timelapseCreator.create(
  imageBytesList: imageBytesList,
  frameRate: frameRate,
);
```

## æœ€å¾Œã«

æ©Ÿä¼šãŒãªã„ã¨ã‚ã¾ã‚Šè§¦ã‚Œã‚‹ã“ã¨ã®ãªã„ Pigeon ã§ã™ãŒã€å‹å®‰å…¨ãªé€šä¿¡ã‚’è¡Œã†ãŸã‚ã«ã¯ã¨ã¦ã‚‚ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã§ã—ãŸã€‚

flutterfire ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§å°å…¥ã•ã‚Œã¦ã„ã‚‹ã®ã‚’è¦‹ã¦ã‹ã‚‰ãšã£ã¨æ°—ã«ãªã£ã¦ã„ãŸã®ã§ã€ä»Šå›ä½¿ãˆã¦ã‚ˆã‹ã£ãŸã§ã™ã€‚

Pigeon ã‚’ä½¿ã£ã¦ Plugin Package ã‚’ä½œæˆã™ã‚‹éš›ã¯ã€ãœã²å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ğŸ¦
